# Task ID: 15
# Title: Implement Drag-and-Drop of Plugin Nodes on Canvas
# Status: pending
# Dependencies: 2, 14
# Priority: high
# Description: Implement drag-and-drop functionality for plugin nodes onto the React Flow canvas, enabling users to visually construct workflows.
# Details:
1.  **Node Registration:** Upon plugin installation (Task 14), register the plugin's node component with React Flow. This involves creating a mapping between the plugin's slug and the corresponding React component.
2.  **Drag Source Implementation:** Implement a drag source using a library like `react-dnd` or a similar drag-and-drop solution. This drag source will be associated with the plugin node in the sidebar.
3.  **Canvas Drop Target:** Configure the React Flow canvas as a drop target. When a plugin node is dragged onto the canvas, create a new node element in the React Flow graph.
4.  **Node Rendering:** Render the dragged plugin node on the canvas using the registered React component. Pass any necessary plugin configuration data to the node component.
5.  **Connection Handling:** Ensure that the newly created node can be connected to other nodes on the canvas. Implement the necessary logic to handle connections between nodes, including validation and data flow.
6.  **Workflow JSON Update:** Update the workflow's JSON representation to reflect the addition of the new node and its connections. This involves modifying the `nodes` and `edges` arrays in the workflow's JSON data.
7.  **State Management:** Use Zustand to manage the state of the React Flow canvas and the workflow's JSON representation. Ensure that changes to the canvas are reflected in the state and vice versa.
8.  **Error Handling:** Implement error handling to gracefully handle cases where a plugin node cannot be dragged or dropped onto the canvas. Provide informative error messages to the user.

# Test Strategy:
1.  **Install a plugin:** Install a plugin using the plugin installation functionality (Task 14).
2.  **Drag and Drop:** Drag the plugin's node from the sidebar onto the React Flow canvas.
3.  **Node Rendering Verification:** Verify that the node is rendered correctly on the canvas with the expected UI and functionality.
4.  **Connection Verification:** Connect the newly created node to other nodes on the canvas. Verify that the connection is established correctly and that data can flow between the nodes.
5.  **JSON Update Verification:** Inspect the workflow's JSON representation to ensure that the new node and its connections are correctly reflected in the `nodes` and `edges` arrays.
6.  **Error Handling Verification:** Attempt to drag and drop a node onto an invalid area of the canvas. Verify that an appropriate error message is displayed to the user.
7.  **Persistence Verification:** Save the workflow and reload it. Verify that the dragged and dropped nodes are still present and connected correctly.

# Subtasks:
## 1. Integrate React Flow Canvas [pending]
### Dependencies: None
### Description: Integrate React Flow into the canvas area of the layout.
### Details:
Install the `react-flow-renderer` library. Import the library and render a basic React Flow component within the canvas area of the `Layout` component. Initialize React Flow with an empty graph.

## 2. Implement Drag Source for Plugin Nodes [pending]
### Dependencies: 15.1
### Description: Implement a drag source for plugin nodes in the sidebar using react-dnd or a similar library. This allows users to initiate the drag-and-drop action.
### Details:
Configure the drag source to carry the necessary data about the plugin node (e.g., plugin slug, default configuration) during the drag operation.
<info added on 2025-06-14T11:49:34.496Z>
This subtask is the foundational step for Task 15 and has no dependencies on other subtasks within this parent task. It is the first step.
</info added on 2025-06-14T11:49:34.496Z>

## 3. Configure Canvas as Drop Target [pending]
### Dependencies: 15.1, 15.2
### Description: Configure the React Flow canvas as a drop target to receive dragged plugin nodes. This involves setting up the drop target to handle the drop event.
### Details:
Define the drop target's behavior when a plugin node is dropped onto it, including preventing default browser behavior and extracting the plugin node data.

## 4. Create and Render New Node on Drop [pending]
### Dependencies: 15.1, 15.2, 15.3
### Description: Upon a successful drop, create a new node element in the React Flow graph and render it on the canvas using the registered React component.
### Details:
Use the plugin slug from the drag data to retrieve the corresponding React component from the node registration mapping. Instantiate the component with any default configuration data. Update Zustand state with the new node.

## 5. Update Workflow JSON and State [pending]
### Dependencies: 15.1, 15.4
### Description: Update the workflow's JSON representation and Zustand state to reflect the addition of the new node, including its position and any default configuration.
### Details:
Modify the `nodes` array in the workflow's JSON data to include the new node's information. Ensure that the state is updated to reflect the changes in the JSON data.

## 6. Implement Basic Connection Handling [pending]
### Dependencies: 15.1, 15.4
### Description: Implement basic connection handling to allow the newly created node to be connected to other nodes on the canvas.
### Details:
Ensure that the new node has input and output handles that can be connected to other nodes. Implement the necessary logic to handle the creation of edges between nodes.

