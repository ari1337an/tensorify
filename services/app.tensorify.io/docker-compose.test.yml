# The containers that compose the project
services:
  db:
    image: postgres:16-alpine
    restart: always
    container_name: integration-tests
    ports:
      - '5433:5432'
    environment:
      POSTGRES_USER: prisma
      POSTGRES_PASSWORD: prisma
      POSTGRES_DB: app_test
    # Create multiple databases for parallel testing
    command: >
      sh -c "
        docker-entrypoint.sh postgres &
        until pg_isready -h localhost -p 5432 -U prisma; do sleep 1; done
        for i in \$$(seq 1 10); do
          createdb -h localhost -p 5432 -U prisma app_test_\$$i || true
        done
        wait
      "