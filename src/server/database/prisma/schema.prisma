generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AdminAccount {
  id          String     @id @default(uuid())
  name        String
  email       String     @unique
  picture     String?
  profileLink String?
  designation String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  BlogPost    BlogPost[]
}

/**
 * Blog Post
 */

enum BlogPostType {
  ANNOUNCEMENT // Product launches, company updates
  ARTICLE // Educational, SEO-driven content for growth
  CUSTOMER_STORY // Case studies, user success stories
  COMPANY_NEWS // Funding, hiring, partnerships
  ENGINEERING_BLOG // Deep tech dives, infra, dev logs
  THOUGHT_LEADERSHIP // Visionary, industry-opinion content
  FEATURE_UPDATE // New features, changelogs
  EVENT // Webinars, meetups, summits
  GUIDE // How-tos, tutorials, onboarding guides
  RESEARCH // Original research, benchmarks, studies
}

model BlogPost {
  id        String         @id @default(uuid())
  type      BlogPostType   @default(ARTICLE)
  title     String
  slug      String         @unique
  authorId  String
  status    BlogPostStatus
  tags      BlogTag[]
  content   Json
  author    AdminAccount   @relation(fields: [authorId], references: [id])
  deletedAt DateTime?
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  seo       BlogSeo?
}

model BlogTag {
  id        String     @id @default(uuid())
  tag       String     @unique
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  posts     BlogPost[]
}

enum BlogPostStatus {
  DRAFT
  PUBLISHED
}

model BlogSeo {
  id                       String   @id @default(uuid())
  metaTitle                String?
  metaDescription          String?
  metaRobots               String?  @default("index, follow")
  keywords                 String?
  canonicalUrl             String?
  ogTitle                  String?
  ogDescription            String?
  ogImage                  String?
  ogUrl                    String?
  ogType                   String?  @default("article")
  ogSiteName               String?
  twitterCardType          String?  @default("summary_large_image")
  twitterTitle             String?
  twitterDescription       String?
  twitterImage             String?
  twitterSite              String?
  blogpostingHeadline      String?
  blogpostingDescription   String?
  blogpostingAuthorName    String?
  blogpostingAuthorUrl     String?
  blogpostingPublisherName String?
  blogpostingPublisherLogo String?
  blogpostingKeywords      String?
  blogpostingFeaturedImage String?
  mainEntityOfPage         String?
  favicon                  String?
  language                 String?  @default("en")
  faqEnabled               Boolean  @default(false)
  faqData                  Json?    @default("{\"questions\":[]}")
  blogPost                 BlogPost @relation(fields: [blogPostId], references: [id], onDelete: Cascade)
  blogPostId               String   @unique
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt
}

/**
 * Onboarding
 */

enum QuestionType {
  single_choice
  multi_choice
}

enum OrgSizeBracket {
  // ONE_TO_FIVE
  // SIX_TO_TWENTY
  // TWENTYONE_TO_FIFTY
  // FIFTYONE_PLUS
  LT_20 // <20
  FROM_20_TO_99 // 20-99
  FROM_100_TO_499 // 100-499
  FROM_500_TO_999 // 500-999
  GTE_1000 // 1000+
}

enum IntentTag {
  WILL_NOT_PAY
  WILL_PAY_HOBBY
  WILL_PAY_TEAM
  ENTERPRISE_POTENTIAL
}

enum TagStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model OnboardingTagVersion {
  id          String    @id @default(uuid())
  tag         String    @unique
  title       String
  description String?
  status      TagStatus @default(DRAFT)
  createdAt   DateTime  @default(now())
  publishedAt DateTime?

  questions OnboardingQuestion[]
  responses OnboardingResponse[]

  @@index([status])
}

model OnboardingQuestion {
  id               String       @id @default(uuid())
  versionId        String
  slug             String
  type             QuestionType
  title            String
  iconSlug         String?
  isActive         Boolean      @default(true)
  sortOrder        Int          @default(0)
  allowOtherOption Boolean      @default(false)
  createdAt        DateTime     @default(now())

  version OnboardingTagVersion @relation(fields: [versionId], references: [id])
  options OnboardingOption[]
  answers OnboardingAnswer[]

  @@index([versionId])
}

model OnboardingOption {
  id         String  @id @default(uuid())
  questionId String
  value      String
  label      String
  iconSlug   String?
  sortOrder  Int?

  question OnboardingQuestion @relation(fields: [questionId], references: [id])
  answers  OnboardingAnswer[]
}

model OnboardingResponse {
  id                String         @id @default(uuid())
  userId            String
  email             String
  clientFingerprint String
  intentTag         IntentTag
  orgSizeBracket    OrgSizeBracket
  tagVersionId      String
  createdAt         DateTime       @default(now())

  tagVersion OnboardingTagVersion @relation(fields: [tagVersionId], references: [id])
  answers    OnboardingAnswer[]

  @@index([userId])
}

model OnboardingAnswer {
  id          String  @id @default(uuid())
  responseId  String
  questionId  String
  optionId    String? // Nullable for "Other"
  customValue String? // Only used when "Other" input is filled

  response OnboardingResponse @relation(fields: [responseId], references: [id])
  question OnboardingQuestion @relation(fields: [questionId], references: [id])
  option   OnboardingOption?  @relation(fields: [optionId], references: [id])
}
